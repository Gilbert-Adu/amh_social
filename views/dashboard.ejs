<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
        <link rel="stylesheet" type="text/css" href="/dashboard.css">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sofia">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">





    </head>
    <body>
        <div id="loading-wrapper">
            <div id="loading-text">LOADING</div>
            <div id="loading-content"></div>
          </div>
          

          <div class="dashboard" id="dashboard" style="visibility: hidden;">
            <div class="nav-container">
                <a href="/" style="text-decoration: none; cursor: pointer;"><div class="app-name">Amhara Unity</div></a>

                <div class="username"> Hi there <%= data.firstName %>! </div>

                <% if (data.role == 'admin') { %>
                    <a href="/allblogs/<%= data._id %>" onclick="getBlogSubmit(`${data}`)" style="text-decoration: none;">
                        <button id="blogs-button"  style="background-color: #007F73;margin-top: 0.5vh; margin-left: 60vw;color: white;height: 5vh;width: 5vw;border: 1px solid #007F73;border-radius: 5px;cursor: pointer;">Blogs</button>
                        
                        
                    </a>
                    <a href="/allblogs/<%= data._id %>" onclick="getBlogSubmit(`${data}`)" style="text-decoration: none;">
                        <button id="blogs-button"  style="background-color: #007F73;margin-top: 0.5vh; margin-right: 0.5vw;color: white;height: 5vh;width: 8vw;border: 1px solid #007F73;border-radius: 5px;cursor: pointer;">Announce</button>
                        
                    </a>
    
                  <% } else { %>


                    <a href="/allblogs/<%= data._id %>" onclick="getBlogSubmit(`${data}`)" style="text-decoration: none;">
                        <button id="blogs-button"  style="background-color: #007F73;margin-top: 0.5vh; margin-left: 60vw;color: white;height: 5vh;width: 5vw;border: 1px solid #007F73;border-radius: 5px;cursor: pointer;">Blogs</button>
                        
                        
                    </a>
                    
                  <% } %>
                  
            </div>

            <% if (annons.length != 0) { %>
               
                
                    <div class="user-announcements">
                        <% annons.forEach((text, index) => { %>
                            <div class="moving-text"><%= text %></div>
                        <% }); %>
                

                    </div>
                    

        
    
             
              <% }  %>
          
            
            <div class="panels-container" id="panels-container">
                <div class="tabs-group">
                    <div class="tabs-buttons">
                        <a href="/allblogs/<%= data._id %>" onclick="getBlogSubmit(`${data}`)" style="text-decoration: none;">
                            <button id="blogs-button"  style="background-color: #5AB2FF;color: white;height: 5vh;width: 10vw;border: 1px solid #5AB2FF;border-radius: 5px;cursor: pointer;">View blogs</button>

                        </a>

                        <button style="background-color: #C40C0C;color: white;height: 5vh;width: 10vw;border: 1px solid #C40C0C;border-radius: 5px;cursor: pointer;">Log Out</button>
                    </div>
                    
                </div>
                <div class="messaging-area" id="messaging-area">
                    <div class="text-area">
                        <div class="message-group">
                            <div class="messages-sent" id="messages-sent">
                                <div class="sent-bubble" id="sent-bubble">

                                    <% if (messages.length > 0) { %>

                                        <% for(let i = 0; i < messages.length; i++) { %>

                                            <div class="message-content" style="border-left: 2px solid <%= messages[i].user.userColor%>">
                                                <span style="color: <%= messages[i].user.userColor%>; font-size: 10px; font-weight: bold;"><%=messages[i].user.firstName%> <%=messages[i].user.lastName%></span><br>
                                                <%= messages[i].message %>
                                            </div>
                                            
                                            
                                        <% } %>
                                

                                            
                                    <% } else { %>

                                    <% } %>
                                
                                
                                </div>

                            </div>
                           
                        
                        </div>
                        
                    </div>
                    <div class="messaging-panel">
                        <span>
                            <form action="/send/<%= data._id %>" method="POST" id="form">
                                <input type="text" value="" name="textMessage" placeholder="Say something..." id="sent-text">
                            </form>
                        </span>
                        <span>
                            <form action="">
                                <label for="image" class="custom-upload-button">
                                    <i class="fas fa-upload"></i>
                                </label>
                                <input type="file" id="image" name="image" accept="image/*">
                                
                    
                                    
                            </form>
                            
                        </span>

                    </div>
                </div>
            </div>
            
          </div>

          
          
          
          
          
          
          
    
          <script src="https://js.pusher.com/7.0/pusher.min.js"></script>

            <script>
                        document.querySelector('.custom-upload-button').addEventListener('click', function() {
                            document.querySelector('#image').click();
                        });

            
                const pusher = new Pusher('be75e3dbef6dc92be9b4', {
                    cluster: 'us2'
                });

                const channel = pusher.subscribe('chat');
                channel.bind('message', (data) => {
                    const item = document.createElement('p');
                    const userID = data.userID;
                     const col = data.user.userColor;
                    item.innerHTML = `
                            <div class="message-content" style="  border-left: 2px solid ${col};">
                            <span style="color: ${col}; font-size: 10px; font-weight: bold;">${data.user.firstName} ${data.user.lastName}</span><br>
                            ${data.message}
                            </div>
                                    
                    `;
                    document.getElementById('sent-bubble').appendChild(item)
                    //console.log(data);
                });

                document.getElementById('form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const message = document.getElementById('sent-text').value;
                    //console.log("message: ", message)
                    fetch('/send/<%= data._id%>', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({message})
                    })
                    document.getElementById('sent-text').value = ''

                });

            </script>
        

          
          
          <script>


            function getBlogSubmit(id) {
                console.log(id)

            }
            function newMessage() {
                var sendButton = document.getElementById('send-button');

                sendButton.addEventListener('click', function () {
                    var sentText = document.getElementById('sent-text').value;
                    var newText = document.createElement('section');
                    newText.innerHTML = `

                    <div class="sent-bubble">${sentText}</div>

                    `
                    document.getElementById('messages-sent').appendChild(newText);
                    sentText.value = " ";



                });
            }

            
          </script>
          <script>
            function loadHandler(delay) {
                const el = document.getElementById('loading-wrapper');
                if (el) {
                    setTimeout(() => {
                        el.style.display = "none";
                    }, delay);
                }
            }
            function dashboardViewHandler(delay) {
                const el = document.getElementById('dashboard');
                if (el) {
                    setTimeout(() => {
                        el.style.visibility = "visible";
                    }, delay);
                }

            }
            loadHandler(5000);
            dashboardViewHandler(6000)
          </script>
          
    </body>
</html>